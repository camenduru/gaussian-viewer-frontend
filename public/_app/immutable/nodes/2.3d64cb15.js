import{s as j,n as D,o as x,f as O,h as R}from"../chunks/scheduler.8b74b908.js";import{S as L,i as X,g as M,h as w,j as S,f as p,k as g,a as C,y as Y}from"../chunks/index.c146e4e6.js";function q(f){let e,i;return{c(){e=M("video"),this.h()},l(t){e=w(t,"VIDEO",{id:!0,src:!0,class:!0}),S(e).forEach(p),this.h()},h(){g(e,"id","player"),R(e.src,i="")||g(e,"src",i),e.autoplay=!0,e.muted=!0,e.controls=!0,g(e,"class","svelte-1jpaclb")},m(t,o){C(t,e,o)},d(t){t&&p(e)}}}function G(f){let e,i="Loading...";return{c(){e=M("div"),e.textContent=i},l(t){e=w(t,"DIV",{"data-svelte-h":!0}),Y(e)!=="svelte-194gxkm"&&(e.textContent=i)},m(t,o){C(t,e,o)},d(t){t&&p(e)}}}function N(f){let e;function i(s,r){return s[0]?G:q}let t=i(f),o=t(f);return{c(){e=M("main"),o.c(),this.h()},l(s){e=w(s,"MAIN",{class:!0});var r=S(e);o.l(r),r.forEach(p),this.h()},h(){g(e,"class","svelte-1jpaclb")},m(s,r){C(s,e,r),o.m(e,null)},p(s,[r]){t!==(t=i(s))&&(o.d(1),o=t(s),o&&(o.c(),o.m(e,null)))},i:D,o:D,d(s){s&&p(e),o.d()}}}const y=3;function V(f,e,i){let t,o,s,r=!0,v=!1,u=30,h=45,_=[0,.5,0];x(async()=>{const n=Math.random().toString(36).substring(2,15);await k(n);const a=document.querySelector("main");a.addEventListener("mousedown",()=>v=!0),a.addEventListener("mouseup",()=>v=!1),a.addEventListener("mousemove",P),i(0,r=!1)}),O(()=>{t&&t.close()});async function k(n){var c={iceServers:await fetch("https://viewer.dylanebert.com/ice-servers",{method:"GET",headers:{"Content-Type":"application/json"}}).then(l=>l.json())};console.log("Creating RTCPeerConnection with config: ",c),t=new RTCPeerConnection(c),t.ontrack=l=>{console.log("Received track:",l),document.getElementById("player").srcObject=l.streams[0]},o=t.createDataChannel("camera");const m={offerToReceiveAudio:!1,offerToReceiveVideo:!0},d=await t.createOffer(m);console.log("Created offer:",d),await t.setLocalDescription(d),console.log("Waiting for ICE gathering to complete..."),await new Promise(l=>{t.iceGatheringState==="complete"?l():t.onicegatheringstatechange=()=>{t.iceGatheringState==="complete"&&l()}}),i(0,r=!1),console.log("Sending offer SDP: ",d);const b=await fetch(`https://viewer.dylanebert.com/offer?session_id=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sdp:t.localDescription.sdp,type:t.localDescription.type})}).then(l=>l.json());console.log("Received answer SDP: ",b),await t.setRemoteDescription(b)}function T(n,a){s||(s=setTimeout(()=>{n(),s=null},a))}function P(n){if(!v)return;const a=n.movementX||n.mozMovementX||n.webkitMovementX||0,c=n.movementY||n.mozMovementY||n.webkitMovementY||0;h-=a*.5,u+=c*.5,u=Math.min(Math.max(u,0),70),h=(h+360)%360;const m=E(u,h),d=[-u,270-h,0];T(()=>{I(m,d)},1e3/30)}function E(n,a){const c=n*Math.PI/180,m=a*Math.PI/180;return[y*Math.cos(m)*Math.cos(c)+_[0],-y*Math.sin(c)+_[1],y*Math.sin(m)*Math.cos(c)+_[2]]}function I(n,a){const c={type:"camera_update",position:n,rotation:a};o.send(JSON.stringify(c))}return[r]}class A extends L{constructor(e){super(),X(this,e,V,N,j,{})}}export{A as component};
