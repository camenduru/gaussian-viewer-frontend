import{s as x,n as E,o as R,f as N,h as $}from"../chunks/scheduler.8b74b908.js";import{S as q,i as G,g as C,h as S,j as k,f as p,k as v,a as T,y as J}from"../chunks/index.c146e4e6.js";function V(u){let e,r;return{c(){e=C("video"),this.h()},l(t){e=S(t,"VIDEO",{id:!0,src:!0,class:!0}),k(e).forEach(p),this.h()},h(){v(e,"id","player"),$(e.src,r="")||v(e,"src",r),e.autoplay=!0,e.muted=!0,e.controls=!0,v(e,"class","svelte-1jpaclb")},m(t,s){T(t,e,s)},d(t){t&&p(e)}}}function z(u){let e,r="Loading...";return{c(){e=C("div"),e.textContent=r},l(t){e=S(t,"DIV",{"data-svelte-h":!0}),J(e)!=="svelte-194gxkm"&&(e.textContent=r)},m(t,s){T(t,e,s)},d(t){t&&p(e)}}}function A(u){let e;function r(a,l){return a[0]?z:V}let t=r(u),s=t(u);return{c(){e=C("main"),s.c(),this.h()},l(a){e=S(a,"MAIN",{class:!0});var l=k(e);s.l(l),l.forEach(p),this.h()},h(){v(e,"class","svelte-1jpaclb")},m(a,l){T(a,e,l),s.m(e,null)},p(a,[l]){t!==(t=r(a))&&(s.d(1),s=t(a),s&&(s.c(),s.m(e,null)))},i:E,o:E,d(a){a&&p(e),s.d()}}}const M=3;function B(u,e,r){let t,s,a,l=!0,f=!1,h=30,m=45,y=[0,.5,0],_=0,w=0;R(async()=>{const n=Math.random().toString(36).substring(2,15);await P(n);const o=document.querySelector("main");o.addEventListener("mousedown",()=>f=!0),o.addEventListener("mouseup",()=>f=!1),o.addEventListener("mousemove",O),o.addEventListener("touchstart",I),o.addEventListener("touchmove",L),o.addEventListener("touchend",()=>f=!1),r(0,l=!1)}),N(()=>{t&&t.close()});async function P(n){var i={iceServers:await fetch("https://viewer.dylanebert.com/ice-servers",{method:"GET",headers:{"Content-Type":"application/json"}}).then(c=>c.json())};console.log("Creating RTCPeerConnection with config: ",i),t=new RTCPeerConnection(i),t.onicecandidate=async({candidate:c})=>{c&&(console.log("Sending ICE candidate: ",c),await fetch(`https://viewer.dylanebert.com/ice-candidate?session_id=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}))},t.ontrack=c=>{console.log("Received track:",c),document.getElementById("player").srcObject=c.streams[0]},s=t.createDataChannel("camera");const d={offerToReceiveAudio:!1,offerToReceiveVideo:!0},g=await t.createOffer(d);console.log("Created offer:",g),await t.setLocalDescription(g),console.log("Waiting for ICE gathering to complete..."),await new Promise(c=>{t.iceGatheringState==="complete"?c():t.onicegatheringstatechange=()=>{t.iceGatheringState==="complete"&&c()}}),r(0,l=!1),console.log("Sending offer SDP: ",g);const D=await fetch(`https://viewer.dylanebert.com/offer?session_id=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sdp:t.localDescription.sdp,type:t.localDescription.type})}).then(c=>c.json());console.log("Received answer SDP: ",D),await t.setRemoteDescription(D)}function j(n,o){a||(a=setTimeout(()=>{n(),a=null},o))}function I(n){f=!0;const o=n.touches[0];_=o.clientX,w=o.clientY}function L(n){if(!f)return;const o=n.touches[0],i=o.clientX-_,d=o.clientY-w;_=o.clientX,w=o.clientY,b(i,d)}function O(n){if(!f)return;const o=n.movementX||n.mozMovementX||n.webkitMovementX||0,i=n.movementY||n.mozMovementY||n.webkitMovementY||0;b(o,i)}function b(n,o){m-=n*.5,h+=o*.5,h=Math.min(Math.max(h,0),70),m=(m+360)%360;const i=X(h,m),d=[-h,270-m,0];j(()=>{Y(i,d)},1e3/30)}function X(n,o){const i=n*Math.PI/180,d=o*Math.PI/180;return[M*Math.cos(d)*Math.cos(i)+y[0],-M*Math.sin(i)+y[1],M*Math.sin(d)*Math.cos(i)+y[2]]}function Y(n,o){const i={type:"camera_update",position:n,rotation:o};s.send(JSON.stringify(i))}return[l]}class H extends q{constructor(e){super(),G(this,e,B,A,x,{})}}export{H as component};
