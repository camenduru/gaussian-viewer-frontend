import{s as N,n as P,o as $,f as B,h as J}from"../chunks/scheduler.8b74b908.js";import{S as V,i as z,g as E,h as S,j as x,f as p,k as v,a as b,y as A}from"../chunks/index.c146e4e6.js";function G(u){let e,c;return{c(){e=E("video"),this.h()},l(t){e=S(t,"VIDEO",{id:!0,src:!0,class:!0}),x(e).forEach(p),this.h()},h(){v(e,"id","player"),J(e.src,c="")||v(e,"src",c),e.autoplay=!0,e.muted=!0,e.controls=!0,e.playsInline=!0,v(e,"class","svelte-129dyx6")},m(t,s){b(t,e,s)},d(t){t&&p(e)}}}function U(u){let e,c="Loading...";return{c(){e=E("div"),e.textContent=c},l(t){e=S(t,"DIV",{"data-svelte-h":!0}),A(e)!=="svelte-194gxkm"&&(e.textContent=c)},m(t,s){b(t,e,s)},d(t){t&&p(e)}}}function F(u){let e;function c(i,l){return i[0]?U:G}let t=c(u),s=t(u);return{c(){e=E("main"),s.c(),this.h()},l(i){e=S(i,"MAIN",{class:!0});var l=x(e);s.l(l),l.forEach(p),this.h()},h(){v(e,"class","svelte-129dyx6")},m(i,l){b(i,e,l),s.m(e,null)},p(i,[l]){t!==(t=c(i))&&(s.d(1),s=t(i),s&&(s.c(),s.m(e,null)))},i:P,o:P,d(i){i&&p(e),s.d()}}}const w=3;async function H(u,e){const c=JSON.stringify(u);console.log("Sending ICE candidate: ",c),await fetch(`https://viewer.dylanebert.com/ice-candidate?session_id=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:c})}function K(u,e,c){let t,s,i,l,y=!0,f=!1,h=30,m=45,g=[0,.5,0],_=0,C=0;$(async()=>{const n=Math.random().toString(36).substring(2,15);await L(n);const o=document.querySelector("main");o.addEventListener("mousedown",()=>f=!0),o.addEventListener("mouseup",()=>f=!1),o.addEventListener("mousemove",j),o.addEventListener("touchstart",X),o.addEventListener("touchmove",Y),o.addEventListener("touchend",()=>f=!1),c(0,y=!1)}),B(()=>{t&&t.close()});async function L(n){navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{a.getTracks().forEach(T=>T.stop())}).catch(a=>{console.error(a)}),console.log("Requesting ICE servers...");var r={iceServers:await fetch("https://viewer.dylanebert.com/ice-servers",{method:"GET",headers:{"Content-Type":"application/json"}}).then(a=>a.json())};console.log("Creating RTCPeerConnection with config: ",r),t=new RTCPeerConnection(r);let d=[];t.onicecandidate=async({candidate:a})=>{a&&d.push(a)},t.ontrack=a=>{console.log("Received track:",a),l=document.getElementById("player"),l.onerror=T=>{console.error("Error: ",T)},l.srcObject=a.streams[0]},s=t.createDataChannel("camera");const k={offerToReceiveAudio:!1,offerToReceiveVideo:!0},M=await t.createOffer(k);console.log("Created offer:",M),await t.setLocalDescription(M),c(0,y=!1),console.log("Sending offer SDP: ",M);const I=await fetch(`https://viewer.dylanebert.com/offer?session_id=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sdp:t.localDescription.sdp,type:t.localDescription.type})}).then(a=>a.json());console.log("Received answer SDP: ",I),await t.setRemoteDescription(I),d.forEach(async a=>{await H(a,n)})}function O(n,o){i||(i=setTimeout(()=>{n(),i=null},o))}function X(n){f=!0;const o=n.touches[0];_=o.clientX,C=o.clientY}function Y(n){if(!f)return;const o=n.touches[0],r=o.clientX-_,d=o.clientY-C;_=o.clientX,C=o.clientY,D(r,d)}function j(n){if(!f)return;const o=n.movementX||n.mozMovementX||n.webkitMovementX||0,r=n.movementY||n.mozMovementY||n.webkitMovementY||0;D(o,r)}function D(n,o){m-=n*.5,h+=o*.5,h=Math.min(Math.max(h,0),70),m=(m+360)%360;const r=R(h,m),d=[-h,270-m,0];O(()=>{q(r,d)},1e3/30)}function R(n,o){const r=n*Math.PI/180,d=o*Math.PI/180;return[w*Math.cos(d)*Math.cos(r)+g[0],-w*Math.sin(r)+g[1],w*Math.sin(d)*Math.cos(r)+g[2]]}function q(n,o){const r={type:"camera_update",position:n,rotation:o};s.send(JSON.stringify(r))}return[y]}class Z extends V{constructor(e){super(),z(this,e,K,F,N,{})}}export{Z as component};
